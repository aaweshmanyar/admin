<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ایڈمن پینل - مسائل ورلڈ</title>
  <meta name="description" content="مسائل ورلڈ کے لیے ایڈمن پینل - فتاویٰ، مضامین، کتابیں، اور بہت کچھ کا نظم کریں۔">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Jameel+Noori+Nastaleeq&family=Lateef&family=Scheherazade+New&display=swap"
    rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>

  <style>
    @font-face {
      font-family: 'NaatFont';
      src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'NaatFont', serif;
      font-size: 80%;
      overscroll-behavior: none;
    }

    .qalam-rich-text-editor {
      background-color: white;
      border-radius: 0.5rem;
      border: 2px solid #aec3b0;
    }

    .ql-editor {
      min-height: 250px;
      font-family: 'Jameel Noori Nastaleeq', serif;
      font-size: 18px;
      direction: rtl;
      text-align: right;
    }

    .ql-toolbar.ql-snow {
      direction: ltr;
    }
  </style>
</head>


<div class="flex h-screen">
  <aside id="ms-sidebar"
    class="w-64 bg-midnight_green text-beige flex-col shadow-2xl fixed top-0 right-0 h-full z-20 transition-transform duration-300 ease-in-out md:relative md:translate-x-0 translate-x-full">
    <div class="p-6 text-center border-b border-midnight_green-400">
      <h1 class="text-3xl font-bold">مسائل ورلڈ</h1>
      <p class="text-sm text-air_force_blue-700">ایڈمن پینل</p>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="#dashboard"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-speedometer2 ml-3 text-2xl"></i>
        <span>ڈیش بورڈ</span>
      </a>
      <a href="#manage-fatawa"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-journal-check ml-3 text-2xl"></i>
        <span>فتاویٰ</span>
      </a>
      <a href="#manage-articles"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-pencil-square ml-3 text-2xl"></i>
        <span>مضامین</span>
      </a>
      <a href="#manage-books"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-book-half ml-3 text-2xl"></i>
        <span>کتابیں</span>
      </a>
      <a href="#manage-ulema"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-people-fill ml-3 text-2xl"></i>
        <span>علمائے کرام</span>
      </a>
      <a href="#manage-categories"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-grid-fill ml-3 text-2xl"></i>
        <span>موضوعات</span>
      </a>
      <a href="#manage-questions"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-patch-question-fill ml-3 text-2xl"></i>
        <span>موصول سوالات</span>
      </a>
      <!-- <a href="#manage-submissions"
                    class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-send-check ml-3 text-2xl"></i>
                    <span>مفتی کی گذارشات</span>
                </a> -->
      <a href="#manage-users"
        class="as-admin-nav-link as-sidebar-link qalam-sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
        <i class="bi bi-person-gear ml-3 text-2xl"></i>
        <span>صارفین کا انتظام</span>
      </a>
    </nav>
    <div class="p-4 border-t border-midnight_green-400">
      <div class="flex items-center p-2 rounded-md hover:bg-rich_black transition">
        <img src="https://placehold.co/40x40/eff6e0/124559?text=A" class="w-10 h-10 rounded-full"
          onerror="this.onerror=null;this.src='https://placehold.co/40x40/eff6e0/124559?text=A';">
        <div class="mr-3">
          <p id="user-name" class="font-bold text-lg">ایڈمن</p>
          <a href="../Login.html" class="text-sm text-air_force_blue-700 hover:text-beige">لاگ
            آؤٹ</a>
        </div>
      </div>
    </div>
  </aside>

  <div id="ms-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden md:hidden"></div>

  <div class="flex-1 flex flex-col">


    <header
      class="bg-white shadow-md p-4 flex flex-col md:flex-row md:justify-between md:items-center gap-3 sticky top-0 z-10">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <button id="ms-sidebar-toggle" class="text-midnight_green text-2xl ml-4">
            <i class="bi bi-list"></i>
          </button>
          <div id="ms-breadcrumb" class="hidden md:block text-sm"></div>
        </div>
        <h1 class="text-xl font-bold text-midnight_green md:hidden">ایڈمن پینل</h1>
      </div>

      <!-- Global Search (added) -->
      <div class="w-full md:w-1/2 relative" dir="rtl">
        <label for="ms-global-search" class="sr-only">تلاش کریں</label>
        <div class="flex gap-2">
          <input id="ms-global-search" type="text"
            class="w-full border border-gray-300 rounded-lg py-3 px-4 text-lg focus:outline-none focus:ring-2 focus:ring-midnight_green"
            placeholder="تلاش کریں… (فتاویٰ، مضامین، کتابیں، علما وغیرہ)" />
          <button id="ms-global-search-btn"
            class="bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition">
            تلاش
          </button>
        </div>

        <!-- Dropdown (added) -->
        <ul id="ms-global-search-suggestions"
          class="absolute z-20 mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg max-h-72 overflow-auto hidden">
          <!-- filled dynamically -->
        </ul>
      </div>
    </header>


    <main class="flex-1 p-4 md:p-6 overflow-y-auto">
      <div id="ms-admin-main-content">

<body class="bg-gray-100">

  <div class="max-w-4xl mx-auto p-6">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">
        موضوع میں ترمیم کریں
      </h1>
      <a href="/Pages/Categories.html"
        class="as-back-link as-admin-nav-link hidden md:flex items-center text-lg text-midnight_green hover:text-rich_black transition">
        <i class="bi bi-arrow-right ml-2"></i>
        فہرست پر واپس جائیں
      </a>
    </div>

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
      <form id="edit-category-form" class="space-y-6">
        <input type="hidden" id="ms-category-id">

        <div>
          <label for="ms-category-name"
            class="block text-xl font-bold text-midnight_green mb-2">موضوع کا نام</label>
          <input type="text" id="ms-category-name"
            class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg"
            required>
        </div>

        <div>
          <label for="ms-category-slug"
            class="block text-xl font-bold text-midnight_green mb-2">URL سلگ</label>
          <input type="text" id="ms-category-slug"
            class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg font-sans"
            style="direction: ltr;" placeholder="auto-generated-slug">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="ms-category-icon"
              class="block text-xl font-bold text-midnight_green mb-2">آئیکن کلاس</label>
            <input type="text" id="ms-category-icon" placeholder="مثال: bi bi-gem"
              class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg"
              required>
          </div>
          <div>
            <label for="ms-category-thumbnail"
              class="block text-xl font-bold text-midnight_green mb-2">موضوع کا تھمبنیل</label>
            <input type="file" id="ms-category-thumbnail"
              class="w-full text-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-beige file:text-midnight_green hover:file:bg-ash_gray">
            <div class="mt-2">
              <img id="current-thumbnail" src="" alt="موجودہ تھمبنیل" class="h-20 rounded border hidden">
            </div>
          </div>
        </div>

        <div>
          <label for="ms-category-description"
            class="block text-xl font-bold text-midnight_green mb-2">موضوع کا تعارف</label>
          <div id="ms-category-description" class="qalam-rich-text-editor"></div>
        </div>

        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
          <button type="submit"
            class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg bg-gray-800 transition">
            اپڈیٹ کریں
          </button>
          <a href="./index.html#manage-categories"
            class="as-cancel-btn w-full md:w-auto bg-ash_gray text-white py-3 px-8 rounded-lg text-lg bg-gray-800 transition text-center">
            منسوخ کریں
          </a>
        </div>
      </form>
    </div>
  </div>

  </body>
  </div>
  </main>

  <script>
    const API_URL = "https://masailworld.onrender.com/api/tags";

    const urlParams = new URLSearchParams(window.location.search);
    const tagId = urlParams.get("id");

    // ✅ Initialize Quill
    const quill = new Quill('#ms-category-description', {
      theme: 'snow',
      placeholder: 'یہاں موضوع کا تعارف درج کریں...',
      modules: {
        toolbar: [
          [{ header: [1, 2, false] }],
          ['bold', 'italic', 'underline'],
          [{ list: 'ordered' }, { list: 'bullet' }],
          ['link']
        ]
      }
    });

    async function fetchCategory(id) {
      try {
        const res = await fetch(`${API_URL}/${id}`);
        if (!res.ok) throw new Error("Failed to fetch category");
        const data = await res.json();

        // ✅ Prefill inputs with fetched data
        document.getElementById("ms-category-id").value = data.id || "";
        document.getElementById("ms-category-name").value = data.Name || "";
        document.getElementById("ms-category-slug").value = data.slug || "";
        document.getElementById("ms-category-icon").value = data.iconClass || "";
       

        // ✅ Set Quill editor content
        quill.clipboard.dangerouslyPasteHTML(data.AboutTags || "");

        // ✅ Show current thumbnail if available
        const imgEl = document.getElementById("current-thumbnail");
        imgEl.src = `${API_URL}/${id}/cover`;
        imgEl.classList.remove("hidden");
      } catch (err) {
        console.error("❌ Error fetching category:", err);
        alert("موضوع کی تفصیل حاصل نہیں ہو سکی");
      }
    }

    document.getElementById("edit-category-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = document.getElementById("ms-category-id").value;
      const formData = new FormData();
      formData.append("Name", document.getElementById("ms-category-name").value.trim());
      formData.append("slug", document.getElementById("ms-category-slug").value.trim());
      formData.append("iconClass", document.getElementById("ms-category-icon").value.trim());

      // ✅ Get Quill editor content
      formData.append("AboutTags", quill.root.innerHTML.trim());

      const fileInput = document.getElementById("ms-category-thumbnail");
      if (fileInput.files.length > 0) {
        formData.append("tagsCover", fileInput.files[0]);
      }

      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          body: formData
        });
        if (!res.ok) throw new Error("Failed to update category");
        alert("✅ موضوع کامیابی سے اپڈیٹ ہوگیا!");
        window.location.href = "./index.html#manage-categories";
      } catch (err) {
        console.error("❌ Error updating category:", err);
        alert("اپڈیٹ ناکام ہوگیا");
      }
    });

    if (tagId) fetchCategory(tagId);
  </script>
</body>
</html>
